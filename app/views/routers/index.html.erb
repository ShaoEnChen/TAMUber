<div style='width: 800px;'>  
  <div id="map" style='width: 800px; height: 400px;'></div>  
</div>  

<script type="text/javascript">  
var map;

function initialize() {
  var mapProp = {
    center: new google.maps.LatLng(38, -78),
    zoom: 6,
    mapTypeId: google.maps.MapTypeId.ROADMAP
  };
  map = new google.maps.Map(document.getElementById('map'), mapProp);
};

initialize();

var directionsDisplay = new google.maps.DirectionsRenderer();
var directionsService = new google.maps.DirectionsService();
var cooridinate = []

function calcRoute() {
  var origin      = new google.maps.LatLng(41.850033, -87.6500523);
  var destination = new google.maps.LatLng(42.850033, -85.6500523);
  var request = {
      origin:      origin,
      destination: destination,
      travelMode:  google.maps.TravelMode.DRIVING
  };
  directionsService.route(request, function(response, status) {
    if (status == google.maps.DirectionsStatus.OK) {
      directionsDisplay.setDirections(response);
      //console.log(response.routes[0])
      //console.log(response.routes[0].overview_path[0].lat())
      //console.log(response.routes[0].overview_path)
      cooridinate = response.routes[0].overview_path
      
      var leg = response.routes[ 0 ].legs[ 0 ];
      
      /*var mapProp = {
        center: new google.maps.LatLng(38, -78),
        zoom: 6,
        mapTypeId: google.maps.MapTypeId.ROADMAP
      };*/
      //map = new google.maps.Map(document.getElementById('map'), mapProp);

      for (var i = 0; i < cooridinate.length; i++) {
          makeMarker( cooridinate[i], "title" );
      } 

      
      //makeMarker( cooridinate[100], 'title' );
      //makeMarker(cooridinate[265], 'title')
    }
    else {
            window.alert('Directions request failed due to ' + status);
    }
  });
}

function makeMarker( position, title ) {
 new google.maps.Marker({
  position: position,
  map: handler.getMap(),
  title: title
 });
}


calcRoute(); // call this anywhere you want


var handler = Gmaps.build('Google');
handler.buildMap({ internal: {id: 'map'}}, function(){
  directionsDisplay.setMap(handler.getMap());
});

//console.log(cooridinate);

handler = Gmaps.build('Google');  
handler.buildMap({ provider: {}, internal: {id: 'map'}}, function(){  
    markers = handler.addMarkers(<%=raw @routers_default.to_json %>);  
    handler.bounds.extendWith(markers);  
    handler.fitMapToBounds();  
}); 
</script>

<p id="notice"><%= notice %></p>

<h1>Routers</h1>

<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Latitude</th>
      <th>Longitude</th>
      <th colspan="3"></th>
    </tr>
  </thead>

  <tbody>
    <% @routers.each do |router| %>
      <tr>
        <td><%= router.name %></td>
        <td><%= router.latitude %></td>
        <td><%= router.longitude %></td>
        <td><%= link_to 'Show', router %></td>
        <td><%= link_to 'Edit', edit_router_path(router) %></td>
        <td><%= link_to 'Destroy', router, method: :delete, data: { confirm: 'Are you sure?' } %></td>
      </tr>
    <% end %>
  </tbody>
</table>

<br>

<%= link_to 'New Router', new_router_path %>