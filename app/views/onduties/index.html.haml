#map

%h3 #{flash[:notice]}

%table#Onduties
	%thead
		%tr
			%th DriverName
			%th PlateNumber
			%th StudentName
			%th StudentId
			%th VehicleLat
			%th VehicleLng
			%th Startlat
			%th Startlng
			%th Endlat
			%th Endlng
			%th isFinished

	%tbody
		- @onduties.each do |onduty|
			%tr
				%td= onduty.driverName
				%td= onduty.plateNumber
				%td= onduty.studentName
				%td= onduty.studentId
				%td= onduty.vehicleLat
				%td= onduty.vehicleLng
				%td= onduty.startLat
				%td= onduty.startLng
				%td= onduty.endLat
				%td= onduty.endLng
				%td= onduty.isFinished

= link_to 'View Admins', users_index_path
= link_to 'View Vehicles', vehicles_path
= link_to 'View Drivers', drivers_path
= link_to 'View Requests', requests_path

:javascript
	let duties = #{ @onduties.to_json.html_safe };
	let handler = Gmaps.build('Google');
	handler.buildMap({
		provider: {},
		internal: { id: 'map' }
	}, () => {
		markers = handler.addMarkers(duties.map(duty => getVehicleMarker(duty)));
		handler.bounds.extendWith(markers);
		handler.fitMapToBounds();
	});

	function getVehicleMarker(duty) {
		return {
			"lat": duty.vehicleLat,
			"lng": duty.vehicleLng,
			"picture": {
				"width":  180,
				"height": 32
			},
			"infowindow": ""
		};
	}
