<div style='width: 800px;'>  
  <div id="map" style='width: 800px; height: 400px;'></div>  
</div>  

<script type="text/javascript">  
var map;

function initialize() {
  var mapProp = {
    center: new google.maps.LatLng(38, -78),
    zoom: 6,
    mapTypeId: google.maps.MapTypeId.ROADMAP
  };
  map = new google.maps.Map(document.getElementById('map'), mapProp);
};

initialize();

var directionsDisplay = new google.maps.DirectionsRenderer();
var directionsService = new google.maps.DirectionsService();
var cooridinate = []

function calcRoute() {
  var origin      = new google.maps.LatLng(<%= @onduty.startLat %>, <%= @onduty.startLng %>);
  var destination = new google.maps.LatLng(<%= @onduty.endLat %>, <%= @onduty.endLng %>);
  var request = {
      origin:      origin,
      destination: destination,
      travelMode:  google.maps.TravelMode.DRIVING
  };
  directionsService.route(request, function(response, status) {
    if (status == google.maps.DirectionsStatus.OK) {
      directionsDisplay.setDirections(response);
      //console.log(response.routes[0])
      //console.log(response.routes[0].overview_path[0].lat())
      //console.log(response.routes[0].overview_path)
      cooridinate = response.routes[0].overview_path
      
      var leg = response.routes[ 0 ].legs[ 0 ];
      
      /*var mapProp = {
        center: new google.maps.LatLng(38, -78),
        zoom: 6,
        mapTypeId: google.maps.MapTypeId.ROADMAP
      };*/
      //map = new google.maps.Map(document.getElementById('map'), mapProp);

      for (var i = 0; i < cooridinate.length; i++) {
          // Directly set marker
          //makeMarker( cooridinate[i], "title" );
          
          // Set marker based on DB 
          if (i%50==0){
              /*$.ajax({
                  type:    "POST",
                  url:     "routers/add_db",
                  data:    { router: {name: "temp"+i, latitude: cooridinate[i].lat(), longitude: cooridinate[i].lng()} },
                  success: function(post){ console.log('success') },
                  error:   function(post){ console.log(this) }
            })*/
          }
          /*$.ajax({
            type:    "POST",
            url:     "http://localhost:3000/routers/",
            data:    { cooridinate: cooridinate[i].lng() },
            success: function(post){ console.log('success') },
            error:   function(post){ console.log(this) }
          })*/
          //$("#s_ip").val(cooridinate[i]) cooridinate: cooridinate[i].lat()
      }  

    }
    else {
            window.alert('Directions request failed due to ' + status);
    }
  });
}

function makeMarker( position, title ) {
 new google.maps.Marker({
  position: position,
  map: handler.getMap(),
  title: title
 });
}


calcRoute(); // call this anywhere you want


var handler = Gmaps.build('Google');
handler.buildMap({ internal: {id: 'map'}}, function(){
  directionsDisplay.setMap(handler.getMap());
});

//console.log(cooridinate);

handler = Gmaps.build('Google');  
handler.buildMap({ provider: {}, internal: {id: 'map'}}, function(){  
    markers = handler.addMarkers(<%=raw @routers_default.to_json %>);  
    handler.bounds.extendWith(markers);  
    handler.fitMapToBounds();  
}); 
</script>

<script type="text/javascript">  
/*handler = Gmaps.build('Google');  
handler.buildMap({ provider: {}, internal: {id: 'map'}}, function(){  
  markers = handler.addMarkers([  
    {  
      "lat": 30.619703,  
      "lng": -96.334977, 
      "picture": {  
        "width":  180,  
        "height": 32  
      },  
      "infowindow": "A&M"  
    }  
  ]);  
  handler.bounds.extendWith(markers);  
  handler.fitMapToBounds();
  handler.getMap().setZoom(16);  
}); */ 
</script>

<p id="notice"><%= notice %></p>

<p>
  <strong>driverName:</strong>
  <%= @onduty.driverName%>
</p>

<p>
  <strong>PlateNumber:</strong>
  <%= @onduty.plateNumber%>
</p>

<p>
  <strong>studentName:</strong>
  <%= @onduty.studentName%>
</p>

<p>
  <strong>studentId:</strong>
  <%= @onduty.studentId%>
</p>

<p>
  <strong>vehicleLat:</strong>
  <%= @onduty.vehicleLat%>
</p>

<p>
  <strong>vehicleLng:</strong>
  <%= @onduty.vehicleLng%>
</p>

<p>
  <strong>startLat:</strong>
  <%= @onduty.startLat%>
</p>
    
<p>
  <strong>startLng:</strong>
  <%= @onduty.startLng%>
</p>

<p>
  <strong>endLat:</strong>
  <%= @onduty.endLat%>
</p>

<p>
  <strong>endLng:</strong>
  <%= @onduty.endLng%>
</p>

<p>
  <strong>isFinished:</strong>
  <%= @onduty.isFinished%>
</p>

<%= link_to 'Back', onduties_path%>
